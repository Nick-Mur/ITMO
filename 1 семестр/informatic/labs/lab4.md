# **Шпаргалка по Docker, виртуализации и контейнеризации**

---

### Виртуализация и контейнеризация

**Виртуализация**

- **Определение**: Технология создания виртуальных машин (VM), которые эмулируют аппаратное обеспечение и позволяют запускать несколько операционных систем на одном физическом сервере.

- **Типы виртуализации**:
  - **Гипервизоры типа 1 (Bare Metal)**: Работают непосредственно на аппаратном обеспечении без ОС хоста. Примеры: VMware ESXi, Microsoft Hyper-V, Xen.
  - **Гипервизоры типа 2 (Hosted)**: Работают поверх существующей ОС как приложения. Примеры: VMware Workstation, Oracle VirtualBox.

- **Преимущества**:
  - **Изоляция и безопасность**: ВМ изолированы друг от друга.
  - **Гибкость**: Запуск разных ОС на одном хосте.
  - **Эффективность использования ресурсов**: Консолидация серверов.

- **Недостатки**:
  - **Производительность**: Накладные расходы гипервизора.
  - **Повышенные требования к оборудованию**: Необходимость в мощном хосте.
  - **Сложность управления**: Требует специальных знаний.

**Контейнеризация**

- **Определение**: Технология изоляции приложений в контейнерах, которые разделяют ядро ОС хоста и обеспечивают легковесную альтернативу ВМ.

- **Docker**:
  - **Контейнеры**: Изолированные среды с собственными файлами, процессами и сетевыми интерфейсами.
  - **Образы Docker**: Шаблоны для создания контейнеров, состоящие из слоев.
  - **Docker Engine**: Среда выполнения, управляющая контейнерами.

- **Преимущества**:
  - **Портативность**: Контейнеры работают одинаково в разных средах.
  - **Быстрое развертывание**: Мгновенный запуск и остановка.
  - **Эффективность ресурсов**: Меньшее потребление памяти и ЦП.

- **Отличия от виртуальных машин**:
  - **Изоляция**: Контейнеры разделяют ядро ОС, ВМ имеют свою ОС.
  - **Производительность**: Контейнеры легковеснее и быстрее.
  - **Размер**: Образы контейнеров обычно меньше образов ВМ.

---

### Создание и управление Dockerfile

**Dockerfile** — файл с инструкциями для сборки Docker-образа.

- **Основные инструкции**:
  - `FROM`: Базовый образ.
  - `RUN`: Выполнение команд во время сборки.
  - `COPY`/`ADD`: Копирование файлов в образ.
  - `CMD`/`ENTRYPOINT`: Команда для запуска контейнера.
  - `EXPOSE`: Оповещение о портах, используемых приложением.
  - `ENV`: Установка переменных окружения.
  - `WORKDIR`: Установка рабочей директории.

**Пример Dockerfile**:

```dockerfile
# Указываем базовый образ
FROM node:14

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем package.json и устанавливаем зависимости
COPY package.json .
RUN npm install

# Копируем исходный код
COPY . .

# Оповещаем о порте
EXPOSE 3000

# Задаем команду для запуска приложения
CMD ["npm", "start"]
```

**Оптимизация Dockerfile**:

- **Минимизируйте количество слоев**: Объединяйте команды `RUN`.
- **Используйте `.dockerignore`**: Исключайте ненужные файлы при копировании.
- **Используйте легковесные базовые образы**: Например, `alpine`.
- **Кэшируйте зависимости**: Копируйте файлы с зависимостями перед исходным кодом.

---

### Образы Docker: создание, запуск, принцип работы

**Создание образа**:

- **Команда**: `docker build -t имя_образа .`
- **Опции**:
  - `-t`: Задает тег (имя) образа.
  - `.`: Путь к Dockerfile.

**Просмотр локальных образов**:

- **Команда**: `docker images`

**Удаление образа**:

- **Команда**: `docker rmi имя_образа`

**Принцип работы образов**:

- **Слои образов**: Каждый шаг в Dockerfile создает новый слой.
- **Кэширование**: Docker кэширует слои для ускорения сборки.
- **Union File System**: Объединяет слои в единый файловый системный образ.

---

### Контейнеры: запуск, отслеживание, объединение

**Запуск контейнера**:

- **Команда**: `docker run [опции] имя_образа`
- **Опции**:
  - `-d`: Запуск в фоне.
  - `-p хостовой_порт:контейнерный_порт`: Проброс портов.
  - `--name имя_контейнера`: Задает имя контейнера.
  - `-v хостовая_путь:контейнерный_путь`: Монтирование томов.

**Примеры**:

- Запуск в фоне с пробросом порта:

  ```bash
  docker run -d -p 80:80 --name myapp имя_образа
  ```

**Отслеживание контейнеров**:

- **Просмотр запущенных контейнеров**: `docker ps`
- **Просмотр всех контейнеров**: `docker ps -a`
- **Просмотр логов**: `docker logs имя_контейнера`
- **Доступ в контейнер**: `docker exec -it имя_контейнера /bin/bash`

**Остановка и удаление контейнеров**:

- **Остановка контейнера**: `docker stop имя_контейнера`
- **Удаление контейнера**: `docker rm имя_контейнера`

**Объединение контейнеров**:

- **Docker Compose**: Инструмент для определения и запуска многоконтейнерных Docker-приложений.
- **Файл `docker-compose.yml`**: Описывает сервисы, сети и тома.

**Пример `docker-compose.yml`**:

```yaml
version: '3'
services:
  web:
    build: .
    ports:
      - "80:80"
  db:
    image: postgres
    environment:
      POSTGRES_PASSWORD: example
```

**Команды Docker Compose**:

- **Запуск сервисов**: `docker-compose up`
- **Остановка сервисов**: `docker-compose down`

---

### Основные команды Docker

- **Сборка образа**: `docker build -t имя_образа .`
- **Запуск контейнера**: `docker run имя_образа`
- **Просмотр образов**: `docker images`
- **Просмотр контейнеров**: `docker ps` (запущенные), `docker ps -a` (все)
- **Остановка контейнера**: `docker stop имя_контейнера`
- **Удаление контейнера**: `docker rm имя_контейнера`
- **Удаление образа**: `docker rmi имя_образа`
- **Вход в контейнер**: `docker exec -it имя_контейнера /bin/bash`
- **Просмотр логов**: `docker logs имя_контейнера`
- **Копирование файлов из/в контейнер**: `docker cp источник назначение`

---

### Виртуализация и контейнеризация: сравнение

**Когда использовать виртуальные машины**:

- Требуется запуск разных операционных систем.
- Необходима полная изоляция.
- Безопасность критична.
- Нужно гарантированное выделение ресурсов.

**Когда использовать контейнеры**:

- Нужна портативность приложения.
- Требуется быстрое масштабирование.
- Эффективное использование ресурсов.
- Применение микросервисной архитектуры.

---

### Полезные советы

- **Оптимизация Dockerfile**:
  - Минимизируйте количество слоев.
  - Используйте кеширование слоев.
  - Удаляйте временные файлы после установки пакетов.

- **Работа с томами**:
  - Используйте тома для хранения данных, чтобы они не терялись при перезапуске контейнера.

- **Сетевые настройки**:
  - Используйте пользовательские сети Docker для лучшей изоляции и управления.

- **Безопасность**:
  - Не запускайте приложения от имени пользователя root внутри контейнера.
  - Регулярно обновляйте образы для устранения уязвимостей.

---

### Дополнительные ресурсы

- **Официальная документация Docker**: [docs.docker.com](https://docs.docker.com/)
- **Docker Hub**: [hub.docker.com](https://hub.docker.com/)
- **Практические упражнения**: Пройдите интерактивные туториалы на [play-with-docker.com](https://labs.play-with-docker.com/)

---

**Заключение**

Понимание и умение работать с Docker, виртуализацией и контейнеризацией позволяет эффективно разрабатывать, развертывать и масштабировать приложения. Используйте эту шпаргалку как быстрое напоминание о ключевых концепциях и командах.