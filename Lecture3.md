# Лекция 3: Права доступа в файловой системе и расширенные возможности Bash

## Содержание

1. [Введение](#введение)
2. [Права доступа в файловой системе](#права-доступа-в-файловой-системе)
   - [Идентификаторы пользователей и групп](#идентификаторы-пользователей-и-групп)
   - [Просмотр прав доступа](#просмотр-прав-доступа)
   - [Типы прав доступа](#типы-прав-доступа)
   - [Изменение прав доступа с помощью `chmod`](#изменение-прав-доступа-с-помощью-chmod)
     - [Буквенная форма записи](#буквенная-форма-записи)
     - [Числовая форма записи](#числовая-форма-записи)
3. [Массивы в Bash](#массивы-в-bash)
   - [Объявление массивов](#объявление-массивов)
   - [Доступ к элементам массива](#доступ-к-элементам-массива)
   - [Перебор элементов массива](#перебор-элементов-массива)
   - [Ассоциативные массивы](#ассоциативные-массивы)
4. [Функции в Bash](#функции-в-bash)
   - [Объявление функций](#объявление-функций)
   - [Возврат значений из функций](#возврат-значений-из-функций)
   - [Передача аргументов в функции](#передача-аргументов-в-функции)
   - [Глобальные и локальные переменные](#глобальные-и-локальные-переменные)
   - [Рекурсивные функции](#рекурсивные-функции)
5. [Заключение](#заключение)

---

## Введение

В данной лекции мы рассмотрим:

- Права доступа к файлам и каталогам в файловой системе Linux.
- Как изменять и управлять правами доступа с помощью команды `chmod`.
- Использование массивов в скриптах Bash.
- Создание и использование функций в Bash, включая рекурсию.

---

## Права доступа в файловой системе

В Linux система прав доступа обеспечивает безопасность и разделение доступа между пользователями. Каждый файл и каталог имеет определенные права доступа, которые определяют, кто и что может с ними делать.

### Идентификаторы пользователей и групп

- **UID (User ID)**: Уникальный идентификатор пользователя.
- **GID (Group ID)**: Уникальный идентификатор группы.

**Просмотр идентификаторов текущего пользователя:**

```bash
id
```

**Пример вывода:**

```
uid=1000(dima) gid=1000(dima) groups=1000(dima),27(sudo),...
```

### Просмотр прав доступа

Команда `ls` с опцией `-l` позволяет просмотреть права доступа к файлам и каталогам.

```bash
ls -l
```

**Пример вывода:**

```
-rw-r--r-- 1 dima dima  4096 Sep  8 12:34 example.txt
drwxr-xr-x 2 dima dima  4096 Sep  8 12:34 my_folder
```

### Типы прав доступа

Права доступа состоят из трех категорий и трех типов:

- **Категории**:
  - **User (u)**: Владелец файла.
  - **Group (g)**: Группа, к которой принадлежит файл.
  - **Others (o)**: Все остальные пользователи.
- **Типы прав**:
  - **Read (r)**: Чтение.
  - **Write (w)**: Запись.
  - **Execute (x)**: Исполнение.

**Структура прав доступа:**

```
[тип][права для владельца][права для группы][права для остальных]
```

**Обозначения:**

- **`-`**: Обычный файл.
- **`d`**: Каталог.
- **`l`**: Символическая ссылка.

**Пример:**

```
-rwxr-xr-- 1 dima dima 4096 Sep 8 12:34 script.sh
```

- **`-`**: Обычный файл.
- **`rwx`**: Владелец может читать, записывать и выполнять.
- **`r-x`**: Группа может читать и выполнять.
- **`r--`**: Остальные могут только читать.

### Изменение прав доступа с помощью `chmod`

Команда `chmod` используется для изменения прав доступа к файлам и каталогам.

#### Буквенная форма записи

**Синтаксис:**

```bash
chmod [кому][операция][права] файл
```

- **Кому**:
  - `u`: Владелец.
  - `g`: Группа.
  - `o`: Остальные.
  - `a`: Все (`u`, `g` и `o`).
- **Операция**:
  - `+`: Добавить права.
  - `-`: Удалить права.
  - `=`: Установить точные права.
- **Права**:
  - `r`: Чтение.
  - `w`: Запись.
  - `x`: Исполнение.

**Примеры:**

- **Добавить право выполнения для всех:**

  ```bash
  chmod a+x script.sh
  ```

- **Удалить право записи для группы и остальных:**

  ```bash
  chmod go-w file.txt
  ```

- **Установить права чтения и выполнения для владельца:**

  ```bash
  chmod u=rx file.txt
  ```

#### Числовая форма записи

Права доступа можно также задавать с помощью чисел в восьмеричной системе.

- **Символы и их значения:**
  - `r` (Read) = 4
  - `w` (Write) = 2
  - `x` (Execute) = 1
- **Комбинации:**
  - `7` (`rwx`) = 4 + 2 + 1
  - `6` (`rw-`) = 4 + 2
  - `5` (`r-x`) = 4 + 1
  - `4` (`r--`) = 4

**Синтаксис:**

```bash
chmod [числовое значение] файл
```

**Примеры:**

- **Полные права для владельца, чтение и выполнение для группы и остальных:**

  ```bash
  chmod 755 script.sh
  ```

- **Чтение и запись для владельца, только чтение для группы и остальных:**

  ```bash
  chmod 644 file.txt
  ```

**Таблица прав доступа:**

| Число | Права | Обозначение |
|-------|-------|-------------|
| 7     | rwx   | Чтение, запись и выполнение |
| 6     | rw-   | Чтение и запись |
| 5     | r-x   | Чтение и выполнение |
| 4     | r--   | Только чтение |
| 0     | ---   | Нет прав |

---

## Массивы в Bash

Массивы позволяют хранить упорядоченные наборы данных в скриптах Bash.

### Объявление массивов

- **Одномерный массив:**

  ```bash
  array_name=(element1 element2 element3)
  ```

- **Инициализация отдельных элементов:**

  ```bash
  array_name[0]="element1"
  array_name[1]="element2"
  ```

- **Объявление массива без инициализации:**

  ```bash
  declare -a array_name
  ```

### Доступ к элементам массива

- **Обращение к элементу по индексу:**

  ```bash
  echo ${array_name[0]}
  ```

- **Вывод всех элементов массива:**

  ```bash
  echo ${array_name[@]}
  ```

- **Количество элементов в массиве:**

  ```bash
  echo ${#array_name[@]}
  ```

- **Индексы массива:**

  ```bash
  echo ${!array_name[@]}
  ```

### Перебор элементов массива

- **С помощью цикла `for`:**

  ```bash
  for element in "${array_name[@]}"; do
      echo "$element"
  done
  ```

- **Перебор индексов массива:**

  ```bash
  for index in "${!array_name[@]}"; do
      echo "Index: $index, Value: ${array_name[$index]}"
  done
  ```

### Ассоциативные массивы

Ассоциативные массивы позволяют использовать строки в качестве ключей.

- **Объявление ассоциативного массива:**

  ```bash
  declare -A assoc_array
  ```

- **Инициализация элементов:**

  ```bash
  assoc_array[key1]="value1"
  assoc_array[key2]="value2"
  ```

- **Доступ к элементам:**

  ```bash
  echo ${assoc_array["key1"]}
  ```

**Пример:**

```bash
declare -A colors
colors[apple]="red"
colors[banana]="yellow"
colors[grape]="purple"

for fruit in "${!colors[@]}"; do
    echo "The color of $fruit is ${colors[$fruit]}"
done
```

---

## Функции в Bash

Функции позволяют структурировать код, избегать дублирования и улучшать читаемость скриптов.

### Объявление функций

**Синтаксис 1:**

```bash
function function_name {
    # Команды
}
```

**Синтаксис 2:**

```bash
function_name () {
    # Команды
}
```

**Пример:**

```bash
greet() {
    echo "Hello, $1!"
}
```

### Возврат значений из функций

Функции в Bash возвращают код выхода (число от 0 до 255). Для явного указания кода возврата используется команда `return`.

**Пример:**

```bash
calculate() {
    local result=$(( $1 + $2 ))
    return $result
}

calculate 2 3
echo "Result: $?"    # Выведет: Result: 5
```

**Важно:** Код возврата ограничен значениями от 0 до 255. Для возврата больших значений или строк используйте вывод через `echo`.

### Передача аргументов в функции

Аргументы передаются так же, как и в скриптах, с помощью `$1`, `$2`, ..., `$@`, `$#`.

**Пример:**

```bash
sum() {
    local total=0
    for number in "$@"; do
        total=$(( total + number ))
    done
    echo "Sum: $total"
}

sum 5 10 15    # Выведет: Sum: 30
```

### Глобальные и локальные переменные

- **Глобальные переменные** доступны во всем скрипте.
- **Локальные переменные** доступны только внутри функции и объявляются с помощью `local`.

**Пример:**

```bash
variable="Global"

my_function() {
    local variable="Local"
    echo "Inside function: $variable"
}

my_function    # Выведет: Inside function: Local
echo "Outside function: $variable"   # Выведет: Outside function: Global
```

### Рекурсивные функции

Функции могут вызывать сами себя для решения задач, которые можно разбить на подзадачи.

**Пример: Вычисление факториала**

```bash
factorial() {
    local n=$1
    if [ "$n" -le 1 ]; then
        echo 1
    else
        local prev=$(factorial $(( n - 1 )))
        echo $(( n * prev ))
    fi
}

result=$(factorial 5)
echo "5! = $result"    # Выведет: 5! = 120
```

**Пример: Числа Фибоначчи**

```bash
fibonacci() {
    local n=$1
    if [ "$n" -le 0 ]; then
        echo 0
    elif [ "$n" -eq 1 ]; then
        echo 1
    else
        local a=$(fibonacci $(( n - 1 )))
        local b=$(fibonacci $(( n - 2 )))
        echo $(( a + b ))
    fi
}

for i in {0..10}; do
    echo "Fibonacci($i) = $(fibonacci $i)"
done
```

---

## Заключение

В этой лекции мы:

- Разобрали систему прав доступа в Linux, научились просматривать и изменять права с помощью команды `chmod`.
- Познакомились с массивами в Bash, узнали, как объявлять и использовать как индексированные, так и ассоциативные массивы.
- Изучили функции в Bash, включая способы их объявления, передачи аргументов, использования локальных переменных и реализации рекурсии.

Эти темы являются важными инструментами для создания эффективных и мощных скриптов, позволяющих автоматизировать множество задач в системе Linux.

---

**Рекомендуемая практика:**

- Создайте скрипт, который обходит директорию и изменяет права доступа к файлам в зависимости от их расширения.
- Напишите функцию, которая сортирует массив чисел.
- Реализуйте рекурсивную функцию для вычисления наибольшего общего делителя (НОД) двух чисел.

---

**Полезные ресурсы:**

- [Официальная документация Bash](https://www.gnu.org/software/bash/manual/bash.html)
- [Advanced Bash-Scripting Guide](https://tldp.org/LDP/abs/html/)
- [Permissions in Linux](https://www.linux.com/training-tutorials/understanding-linux-file-permissions/)
